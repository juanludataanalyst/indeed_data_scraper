
# Diccionario con tecnologías y sus variaciones
skills_analytics = {
    'sql': [
        'SQL', 'Sql', 'sQl', 'sqL', 'Structured Query Language', 'Structured query language', 
        'structured query language'
    ],
    'python': [
        'Python', 'PYTHON', 'Py', 'py', 'Python3', 'python 3', 'Python 3.x'
    ],
    'r': [
        'R', 'r', 'R Programming', 'r programming'
    ],
    'c': [
        'C', 'c', 'C Language', 'c language'
    ],
    'c#': [
        'C#', 'c#', 'C Sharp', 'c sharp'
    ],
    'javascript': [
        'JavaScript', 'javascript', 'Java script', 'javaScript', 'JS', 'js', 
        'ECMAScript', 'ecmascript'
    ],
        'java': [
        'Java', 'java', 'Java SE', 'java se'
    ],
    'scala': [
        'Scala', 'scala'
    ],
    'sas': [
        'SAS', 'sas', 'Statistical Analysis System', 'statistical analysis system'
    ],
    'matlab': [
        'MATLAB', 'matlab', 'MATLAB Language', 'matlab language'
    ],
    'c++': [
        'C++', 'c++', 'C Plus Plus', 'c plus plus'
    ],
    'c/c++': [
        'C/C++', 'C / C++', 'C and C++', 'c/c++', 'c and c++'
    ],
    'perl': [
        'Perl', 'perl'
    ],
    'typescript': [
        'TypeScript', 'typescript', 'TS', 'ts'
    ],
    'bash': [
        'Bash', 'bash', 'Bourne Again Shell', 'bourne again shell'
    ],
   
    'php': [
        'PHP', 'php', 'Hypertext Preprocessor', 'hypertext preprocessor'
    ],
    'powershell': [
        'PowerShell', 'powershell', 'Windows PowerShell', 'windows powershell'
    ],
    'rust': [
        'Rust', 'rust'
    ],
    'kotlin': [
        'Kotlin', 'kotlin'
    ],
    'ruby': [
        'Ruby', 'ruby'
    ],
    'dart': [
        'Dart', 'dart'
    ],
    'assembly': [
        'Assembly', 'assembly', 'Assembly Language', 'assembly language'
    ],
    'swift': [
        'Swift', 'swift'
    ],
    'vba': [
        'VBA', 'vba', 'Visual Basic for Applications', 'visual basic for applications'
    ],
    'lua': [
        'Lua', 'lua'
    ],
    'groovy': [
        'Groovy', 'groovy'
    ],
    'delphi': [
        'Delphi', 'delphi'
    ],
    'objective-c': [
        'Objective-C', 'objective-c', 'Objective C', 'objective c'
    ],
    'haskell': [
        'Haskell', 'haskell'
    ],
    'elixir': [
        'Elixir', 'elixir'
    ],
    'julia': [
        'Julia', 'julia'
    ],
    'clojure': [
        'Clojure', 'clojure'
    ],
    'solidity': [
        'Solidity', 'solidity'
    ],
    'lisp': [
        'Lisp', 'lisp'
    ],
    'f#': [
        'F#', 'f#', 'F Sharp', 'f sharp'
    ],
    'fortran': [
        'Fortran', 'fortran'
    ],
    'erlang': [
        'Erlang', 'erlang'
    ],
    'apl': [
        'APL', 'apl'
    ],
    'cobol': [
        'COBOL', 'cobol'
    ],
    'ocaml': [
        'OCaml', 'ocaml'
    ],
    'crystal': [
        'Crystal', 'crystal'
    ],
    'javascript/typescript': [
        'JavaScript / TypeScript', 'javascript / typescript', 'JS / TS', 
        'js / ts', 'JavaScript and TypeScript', 'javascript and typescript'
    ],
    'golang': [
        'Golang', 'golang', 'Go', 'go'
    ],
    'nosql': [
        'NoSQL', 'nosql', 'No-SQL', 'no-sql'
    ],
    'mongodb': [
        'MongoDB', 'mongodb'
    ],
    't-sql': [
        'Transact-SQL', 'T-SQL', 't-sql'
    ],
    'visual_basic': [
        'Visual Basic', 'visual basic', 'VB', 'vb'
    ],
    'pascal': [
        'Pascal', 'pascal'
    ],
    'mongo': [
        'Mongo', 'mongo', 'MongoDB'
    ],
    'pl/sql': [
        'PL/SQL', 'pl/sql'
    ],
    'sass': [
        'Sass', 'sass'
    ],
    'vb.net': [
        'VB.NET', 'vb.net', 'Visual Basic .NET', 'visual basic .net'
    ],
    'mssql': [
        'MSSQL', 'mssql', 'Microsoft SQL Server', 'microsoft sql server'
    ],
    'airflow': [
        'Airflow', 'airflow'
    ],
    'alteryx': [
        'Alteryx', 'alteryx'
    ],
    'asp.net': [
        'ASP.NET', 'asp.net'
    ],
    'atlassian': [
        'Atlassian', 'atlassian'
    ],
    'excel': [
        'Excel', 'excel', 'Microsoft Excel', 'microsoft excel'
    ],
    'power_bi': [
        'Power BI', 'power bi'
    ],
    'tableau': [
        'Tableau', 'tableau'
    ],
    'srss': [
        'SRSS', 'srss', 'SQL Server Reporting Services', 'sql server reporting services'
    ],
    'word': [
        'Word', 'word', 'Microsoft Word', 'microsoft word'
    ],
    'unix': [
        'Unix', 'unix'
    ],
    'vue': [
        'Vue', 'vue', 'Vue.js', 'vue.js'
    ],
    'jquery': [
        'jQuery', 'jquery'
    ],
    'linux/unix': [
        'Linux / Unix', 'linux / unix', 'Linux and Unix', 'linux and unix'
    ],
    'seaborn': [
        'Seaborn', 'seaborn'
    ],
    'microstrategy': [
        'MicroStrategy', 'microstrategy'
    ],
    'spss': [
        'SPSS', 'spss'
    ],
    'visio': [
        'Visio', 'visio'
    ],
    'gdpr': [
        'GDPR', 'gdpr', 'General Data Protection Regulation', 'general data protection regulation'
    ],
    'ssrs': [
        'SSRS', 'ssrs', 'SQL Server Reporting Services', 'sql server reporting services'
    ],
    'spreadsheet': [
        'Spreadsheet', 'spreadsheet'
    ],
    'aws': [
        'AWS', 'aws', 'Amazon Web Services', 'amazon web services'
    ],
    'hadoop': [
        'Hadoop', 'hadoop'
    ],
    'ssis': [
        'SSIS', 'ssis', 'SQL Server Integration Services', 'sql server integration services'
    ],
    'linux': [
        'Linux', 'linux'
    ],
    'sap': [
        'SAP', 'sap', 'Systems Applications and Products', 'systems applications and products'
    ],
    'powerpoint': [
        'PowerPoint', 'powerpoint'
    ],
    'sharepoint': [
        'SharePoint', 'sharepoint'
    ],
    'redshift': [
        'Redshift', 'redshift', 'Amazon Redshift', 'amazon redshift'
    ],
    'snowflake': [
        'Snowflake', 'snowflake'
    ],
    'qlik': [
        'Qlik', 'qlik'
    ],
    'cognos': [
        'Cognos', 'cognos'
    ],
    'pandas': [
        'Pandas', 'pandas'
    ],
    'spark': [
        'Spark', 'spark'
    ],
    'outlook': [
        'Outlook', 'outlook', 'Microsoft Outlook', 'microsoft outlook'
    ],
}

skills_ = {
    'sql': [
        'SQL', 'Sql', 'sQl', 'sqL', 'Structured Query Language', 'structured query language'
    ],
    'python': [
        'Python', 'PYTHON', 'Py', 'py', 'Python3', 'python 3', 'Python 3.x'
    ],
    'java': [
        'Java', 'java', 'Java SE', 'java se', 'Java8', 'java 8'
    ],
    'c': [
        'C', 'c', 'C Language', 'c language'
    ],
    'c#': [
        'C#', 'c#', 'C Sharp', 'c sharp'
    ],
    'javascript': [
        'JavaScript', 'javascript', 'JS', 'js', 'ECMAScript', 'ecmascript'
    ],
    'typescript': [
        'TypeScript', 'typescript', 'TS', 'ts'
    ],
    'ruby': [
        'Ruby', 'ruby', 'Ruby on Rails', 'ruby on rails', 'RoR', 'ror'
    ],
    'php': [
        'PHP', 'php', 'Hypertext Preprocessor', 'hypertext preprocessor'
    ],
    'swift': [
        'Swift', 'swift', 'SwiftUI', 'swiftui'
    ],
    'objective-c': [
        'Objective-C', 'objective-c', 'Objective C', 'objective c'
    ],
    'kotlin': [
        'Kotlin', 'kotlin', 'Android Kotlin', 'android kotlin'
    ],
    'scala': [
        'Scala', 'scala'
    ],
    'rust': [
        'Rust', 'rust'
    ],
    'go': [
        'Go', 'go', 'Golang', 'golang'
    ],
    'dart': [
        'Dart', 'dart', 'Flutter', 'flutter'
    ],
    'r': [
        'R', 'r', 'R Programming', 'r programming'
    ],
    'c++': [
        'C++', 'c++', 'C Plus Plus', 'c plus plus'
    ],
    'c/c++': [
        'C/C++', 'c/c++', 'C and C++', 'c and c++'
    ],
    'perl': [
        'Perl', 'perl'
    ],
    'bash': [
        'Bash', 'bash', 'Shell Scripting', 'shell scripting', 'sh'
    ],
 
    'sass': [
        'Sass', 'sass', 'SCSS', 'scss'
    ],
    'less': [
        'Less', 'less'
    ],
    'xml': [
        'XML', 'xml', 'Extensible Markup Language', 'extensible markup language'
    ],
    'json': [
        'JSON', 'json', 'JavaScript Object Notation', 'javascript object notation'
    ],
    'docker': [
        'Docker', 'docker', 'Docker Containers', 'docker containers'
    ],
    'kubernetes': [
        'Kubernetes', 'kubernetes', 'K8s', 'k8s'
    ],
    'terraform': [
        'Terraform', 'terraform', 'IaC', 'iac', 'Infrastructure as Code', 'infrastructure as code'
    ],
    'ansible': [
        'Ansible', 'ansible'
    ],
    'jenkins': [
        'Jenkins', 'jenkins', 'CI/CD', 'ci/cd'
    ],
    'travis_ci': [
        'Travis CI', 'travis ci', 'Travis', 'travis'
    ],
    'circleci': [
        'CircleCI', 'circleci', 'Circle CI', 'circle ci'
    ],
    'git': [
        'Git', 'git', 'Version Control', 'version control', 'GitHub', 'GitLab', 'gitlab', 'github'
    ],
    'mercurial': [
        'Mercurial', 'mercurial', 'HG', 'hg'
    ],
    'svn': [
        'SVN', 'svn', 'Apache Subversion', 'apache subversion'
    ],
    'apache': [
        'Apache', 'apache', 'Apache Server', 'apache server'
    ],
    'nginx': [
        'Nginx', 'nginx', 'Nginx Server', 'nginx server'
    ],
    'redis': [
        'Redis', 'redis'
    ],
    'memcached': [
        'Memcached', 'memcached'
    ],
    'elasticsearch': [
        'Elasticsearch', 'elasticsearch', 'Elastic Search', 'elastic search'
    ],
    'aws': [
        'AWS', 'aws', 'Amazon Web Services', 'amazon web services'
    ],
    'azure': [
        'Azure', 'azure', 'Microsoft Azure', 'microsoft azure'
    ],
    'gcp': [
        'GCP', 'gcp', 'Google Cloud Platform', 'google cloud platform'
    ],
    'ibm_cloud': [
        'IBM Cloud', 'ibm cloud', 'IBM Bluemix', 'ibm bluemix'
    ],
    'oracle_cloud': [
        'Oracle Cloud', 'oracle cloud'
    ],
    'hadoop': [
        'Hadoop', 'hadoop'
    ],
    'spark': [
        'Spark', 'spark', 'Apache Spark', 'apache spark'
    ],
    'flink': [
        'Flink', 'flink', 'Apache Flink', 'apache flink'
    ],
    'rabbitmq': [
        'RabbitMQ', 'rabbitmq'
    ],
    'apache_kafka': [
        'Apache Kafka', 'apache kafka', 'Kafka', 'kafka'
    ],
    'graphql': [
        'GraphQL', 'graphql'
    ],
    'rest': [
        'REST', 'rest', 'Rest API', 'rest api', 'RESTful', 'restful'
    ],
    'grpc': [
        'gRPC', 'grpc', 'Google RPC', 'google rpc'
    ],
    'soap': [
        'SOAP', 'soap', 'Simple Object Access Protocol', 'simple object access protocol'
    ],
    'mongodb': [
        'MongoDB', 'mongodb', 'Mongo', 'mongo'
    ],
    'postgresql': [
        'PostgreSQL', 'postgresql', 'Postgres', 'postgres'
    ],
    'mysql': [
        'MySQL', 'mysql'
    ],
    'oracle': [
        'Oracle', 'oracle', 'Oracle Database', 'oracle database'
    ],
    'sqlite': [
        'SQLite', 'sqlite'
    ],
    'mariadb': [
        'MariaDB', 'mariadb'
    ],
    'firebase': [
        'Firebase', 'firebase'
    ],
    'power_bi': [
        'Power BI', 'power bi'
    ],
    'tableau': [
        'Tableau', 'tableau'
    ],
    'qlik': [
        'Qlik', 'qlik'
    ],
    'microstrategy': [
        'MicroStrategy', 'microstrategy'
    ],
    'jira': [
        'JIRA', 'jira', 'Atlassian JIRA', 'atlassian jira'
    ],
    'confluence': [
        'Confluence', 'confluence', 'Atlassian Confluence', 'atlassian confluence'
    ],
    'gitlab_ci': [
        'GitLab CI', 'gitlab ci'
    ],
    'salesforce': [
        'Salesforce', 'salesforce', 'SFDC', 'sfdc'
    ],
    'snowflake': [
        'Snowflake', 'snowflake'
    ],
    'bigquery': [
        'BigQuery', 'bigquery', 'Google BigQuery', 'google bigquery'
    ],
    'cloud_firestore': [
        'Cloud Firestore', 'cloud firestore', 'Firestore', 'firestore'
    ],
    'airflow': [
        'Airflow', 'airflow'
    ],
    'databricks': [
        'Databricks', 'databricks'
    ],
    'pandas': [
        'Pandas', 'pandas'
    ],
    'numpy': [
        'NumPy', 'numpy'
    ],
    'scipy': [
        'SciPy', 'scipy'
    ],
    'matplotlib': [
        'Matplotlib', 'matplotlib'
    ],
    'seaborn': [
        'Seaborn', 'seaborn'
    ],
    'scikit_learn': [
        'Scikit-learn', 'scikit-learn', 'sklearn', 'sk-learn', 'Sklearn'
    ],
    'tensorflow': [
        'TensorFlow', 'tensorflow'
    ],
    'keras': [
        'Keras', 'keras'
    ],
    'pytorch': [
        'PyTorch', 'pytorch', 'Torch', 'torch'
    ],
    'mxnet': [
        'MXNet', 'mxnet'
    ],
    'xgboost': [
        'XGBoost', 'xgboost'
    ],
    'lightgbm': [
        'LightGBM', 'lightgbm'
    ],
    'catboost': [
        'CatBoost', 'catboost'
    ]
}



skills = {
    'sql': [
        'SQL', 'Sql', 'sQl', 'sqL', 'Structured Query Language', 'structured query language'
    ],
    'python': [
        'Python', 'PYTHON', 'Py', 'py', 'Python3', 'python 3', 'Python 3.x'
    ],
    'java': [
        'Java', 'java', 'Java SE', 'java se', 'Java8', 'java 8'
    ],
    'c': [
        'C', 'c', 'C Language', 'c language'
    ],
    'c#': [
        'C#', 'c#', 'C Sharp', 'c sharp'
    ],
    'javascript': [
        'JavaScript', 'javascript', 'JS', 'js', 'ECMAScript', 'ecmascript'
    ],
    'typescript': [
        'TypeScript', 'typescript', 'TS', 'ts'
    ],
    'ruby': [
        'Ruby', 'ruby', 'Ruby on Rails', 'ruby on rails', 'RoR', 'ror'
    ],
    'php': [
        'PHP', 'php', 'Hypertext Preprocessor', 'hypertext preprocessor'
    ],
    'swift': [
        'Swift', 'swift', 'SwiftUI', 'swiftui'
    ],
    'objective-c': [
        'Objective-C', 'objective-c', 'Objective C', 'objective c'
    ],
    'kotlin': [
        'Kotlin', 'kotlin', 'Android Kotlin', 'android kotlin'
    ],
    'scala': [
        'Scala', 'scala'
    ],
    'rust': [
        'Rust', 'rust'
    ],
    'go': [
        'Go', 'go', 'Golang', 'golang'
    ],
    'dart': [
        'Dart', 'dart', 'Flutter', 'flutter'
    ],
    'r': [
        'R', 'r', 'R Programming', 'r programming'
    ],
    'c++': [
        'C++', 'c++', 'C Plus Plus', 'c plus plus'
    ],
    'c/c++': [
        'C/C++', 'c/c++', 'C and C++', 'c and c++'
    ],
    'perl': [
        'Perl', 'perl'
    ],
    'bash': [
        'Bash', 'bash', 'Shell Scripting', 'shell scripting', 'sh'
    ],
    'sass': [
        'Sass', 'sass', 'SCSS', 'scss'
    ],
    'less': [
        'Less', 'less'
    ],
    'xml': [
        'XML', 'xml', 'Extensible Markup Language', 'extensible markup language'
    ],
    'json': [
        'JSON', 'json', 'JavaScript Object Notation', 'javascript object notation'
    ],
    'docker': [
        'Docker', 'docker', 'Docker Containers', 'docker containers'
    ],
    'kubernetes': [
        'Kubernetes', 'kubernetes', 'K8s', 'k8s'
    ],
    'terraform': [
        'Terraform', 'terraform', 'IaC', 'iac', 'Infrastructure as Code', 'infrastructure as code'
    ],
    'ansible': [
        'Ansible', 'ansible'
    ],
    'jenkins': [
        'Jenkins', 'jenkins', 'CI/CD', 'ci/cd'
    ],
    'travis_ci': [
        'Travis CI', 'travis ci', 'Travis', 'travis'
    ],
    'circleci': [
        'CircleCI', 'circleci', 'Circle CI', 'circle ci'
    ],
    'git': [
        'Git', 'git', 'Version Control', 'version control', 'GitHub', 'GitLab', 'gitlab', 'github'
    ],
    'mercurial': [
        'Mercurial', 'mercurial', 'HG', 'hg'
    ],
    'svn': [
        'SVN', 'svn', 'Apache Subversion', 'apache subversion'
    ],
    'apache': [
        'Apache', 'apache', 'Apache Server', 'apache server'
    ],
    'nginx': [
        'Nginx', 'nginx', 'Nginx Server', 'nginx server'
    ],
    'aws': [
        'AWS', 'aws', 'Amazon Web Services', 'amazon web services'
    ],
    'hadoop': [
        'Hadoop', 'hadoop'
    ],
    'power_bi': [
        'Power BI', 'power bi'
    ],
    'tableau': [
        'Tableau', 'tableau'
    ],
    'excel': [
        'Excel', 'excel', 'Microsoft Excel', 'microsoft excel'
    ],
    'pandas': [
        'Pandas', 'pandas'
    ],
    'spark': [
        'Spark', 'spark'
    ],
    'r': [
        'R', 'r', 'R Programming', 'r programming'
    ],
    'cybersecurity': [
        'Cybersecurity', 'cyber security', 'Cyber Security', 'InfoSec', 'Information Security'
    ],
    'network_security': [
        'Network Security', 'network security'
    ],
    'encryption': [
        'Encryption', 'encryption'
    ],
    'penetration_testing': [
        'Penetration Testing', 'penetration testing', 'PenTest', 'pentest'
    ],
    'incident_response': [
        'Incident Response', 'incident response'
    ],
    'firewalls': [
        'Firewalls', 'firewall'
    ],
    'malware_analysis': [
        'Malware Analysis', 'malware analysis'
    ],
    'vulnerability_management': [
        'Vulnerability Management', 'vulnerability management'
    ],
    'security_auditing': [
        'Security Auditing', 'security auditing'
    ],
}




import json
import re
import os
import hashlib

# Obtener el directorio de trabajo actual
current_directory = os.getcwd()

# Especificar el directorio de datos
data_directory = os.path.join(current_directory, 'data')

# Función para generar un identificador único basado en la descripción del trabajo
def generate_job_id(description):
    # Usa hashlib para generar un hash a partir de la descripción
    return hashlib.md5(description.encode('utf-8')).hexdigest()

# Función para procesar archivos JSON en un directorio específico
def process_json_files(directory):
    processed_data = []
    
    # Leer todos los subdirectorios en el directorio de datos
    for subdir in os.listdir(directory):
        subdir_path = os.path.join(directory, subdir)
        
        if os.path.isdir(subdir_path):
            # Extraer fecha, país y rol del nombre del directorio
            date, country, role = subdir.split('_')
            
            # Leer todos los archivos JSON en el subdirectorio
            for file_name in os.listdir(subdir_path):
                if file_name.endswith('.json'):
                    file_path = os.path.join(subdir_path, file_name)
                    
                    # Cargar el archivo JSON
                    try:
                        with open(file_path, 'r', encoding='utf-8') as f:
                            data = json.load(f)
                    except FileNotFoundError:
                        print(f"Error: El archivo {file_path} no se encontró.")
                        continue
                    except json.JSONDecodeError as e:
                        print(f"Error al leer el archivo JSON: {e}")
                        continue

                    # Compilar expresiones regulares para cada tecnología
                    patterns = {key: re.compile(r'\b(' + '|'.join(map(re.escape, variations)) + r')\b', re.IGNORECASE) for key, variations in skills.items()}

                    # Extraer tecnologías
                    def extract_technologies(description):
                        found_technologies = set()  # Usar un conjunto para evitar duplicados
                        for key, pattern in patterns.items():
                            if pattern.search(description):
                                found_technologies.add(key)  # Agregar solo la clave (tecnología)
                        return list(found_technologies)  # Convertir el conjunto de vuelta a una lista

                    # Procesar cada puesto en el JSON y crear una nueva estructura
                    for job in data:
                        title = job.get("title", "")
                        company = job.get("company", "")
                        description = job.get("description", "")
                        salary = job.get("salary", "No especificado")
                        employment_type = job.get("employment_type", "No especificado")
                        technologies = extract_technologies(description)

                        # Generar un job_id único basado en la descripción
                        job_id = generate_job_id(description)

                        # Extraer la ubicación de la empresa
                        location = company.split('\n')[1] if '\n' in company else "Ubicación no especificada"
                        company_cleaned = company.split('\n')[0] if '\n' in company else company

                        # Crear un nuevo diccionario para el puesto procesado
                        processed_job = {
                            "job_id": job_id,
                            "title": title,
                            "company": company_cleaned,
                            "location": location,
                            "skills": technologies,
                            "salary": salary,
                            "employment_type": employment_type,
                            "date": date,
                            "country": country,
                            "role": role
                        }
                        processed_data.append(processed_job)

    return processed_data

# Procesar todos los archivos JSON y guardar los resultados en un nuevo archivo
processed_data = process_json_files(data_directory)

# Guardar el nuevo JSON en un archivo
output_file_name = 'joined_data.json'
output_file_path = os.path.join(current_directory, output_file_name)

try:
    with open(output_file_path, 'w', encoding='utf-8') as f:
        json.dump(processed_data, f, ensure_ascii=False, indent=4)
    print(f"Datos procesados guardados en: {output_file_path}")
except Exception as e:
    print(f"Error al guardar el archivo JSON: {e}")
